/*
CREATED BY SAMIRA ALVES LUCIO DIAS
DATE: 21/08/2020
GOAL: Report developed to return exams realized by the doctor 619
*/

CREATE OR REPLACE FORCE VIEW VDIC_PRODUCAO_MEDICA (
       CD_LAUDO
      ,CD_PED_RX
      ,DT_ATENDIMENTO
      ,DT_LAUDO
      ,NM_USUARIO
      ,DT_PEDIDO
      ,CD_ATENDIMENTO
      ,CD_PRESTADOR
      ,NM_PRESTADOR
      ,NM_PACIENTE
      ,NM_SET_EXA
) AS

SELECT LAUDO_RX.CD_LAUDO
      ,LAUDO_RX.CD_PED_RX
      ,ATENDIME.DT_ATENDIMENTO
      ,LAUDO_RX.DT_LAUDO
      ,LAUDO_RX.NM_USUARIO
      ,PED_RX.DT_PEDIDO
      ,PED_RX.CD_ATENDIMENTO
      ,PRESTADOR.CD_PRESTADOR
      ,PRESTADOR.NM_PRESTADOR
      ,PACIENTE.NM_PACIENTE
      ,SET_EXA.NM_SET_EXA
FROM ITPED_RX ITPED_RX
INNER JOIN PED_RX PED_RX
  ON PED_RX.CD_PED_RX = ITPED_RX.CD_PED_RX
INNER JOIN ATENDIME ATENDIME
  ON ATENDIME.CD_ATENDIMENTO = PED_RX.CD_ATENDIMENTO
INNER JOIN PACIENTE PACIENTE
  ON PACIENTE.CD_PACIENTE = ATENDIME.CD_PACIENTE
INNER JOIN LAUDO_RX LAUDO_RX
  ON ITPED_RX.CD_LAUDO = LAUDO_RX.CD_LAUDO
INNER JOIN PRESTADOR PRESTADOR
  ON PRESTADOR.CD_PRESTADOR = LAUDO_RX.CD_PRESTADOR
INNER JOIN SET_EXA SET_EXA
  ON SET_EXA.CD_SET_EXA = PED_RX.CD_SET_EXA

WHERE ATENDIME.CD_MULTI_EMPRESA = '3'
AND LAUDO_RX.CD_PRESTADOR = '619'
AND PED_RX.cd_set_exa in ('34','33','37','39')
--AND TRUNC(ATENDIME.DT_ATENDIMENTO) BETWEEN '01/05/2020' AND '31/05/2020'
ORDER BY LAUDO_RX.DT_LAUDO
        ,SET_EXA.NM_SET_EXA
        ,PACIENTE.NM_PACIENTE
/
GRANT SELECT ON VDIC_PRODUCAO_MEDICA TO biconexao;
GRANT SELECT ON VDIC_PRODUCAO_MEDICA TO dbacp WITH GRANT OPTION;
GRANT SELECT ON VDIC_PRODUCAO_MEDICA TO dbaportal WITH GRANT OPTION;
GRANT DELETE,INSERT,SELECT,UPDATE ON VDIC_PRODUCAO_MEDICA TO dbaps;
GRANT DELETE,INSERT,SELECT,UPDATE ON VDIC_PRODUCAO_MEDICA TO dbasgu;
GRANT DELETE,INSERT,SELECT,UPDATE ON VDIC_PRODUCAO_MEDICA TO mv2000;
GRANT DELETE,INSERT,SELECT,UPDATE ON VDIC_PRODUCAO_MEDICA TO mvintegra;